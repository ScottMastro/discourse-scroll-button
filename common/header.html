<script type="text/discourse-plugin" version="0.8">
  const ajax = require('discourse/lib/ajax').ajax;
  const { h } = require('virtual-dom');
  const { iconNode } = require("discourse-common/lib/icon-library");
  const { getOwner } = require("discourse-common/lib/get-owner");
  const topicController = getOwner(this).lookup("controller:topic");

  api.modifyClass('component:topic-timeline', {
    
    clickButtonScrollUp() {
      topicController.send('jumpTop');
    },
    clickButtonScrollDown() {
      topicController.send('jumpBottom');
    }
    
  });


  api.createWidget('scroll-up-button', {
    tagName: 'widget-button.btn.btn-default.discourse-scroll-up-button.no-text.btn-icon',
    html(attrs, state) {
      return h('span', [iconNode('arrow-up')] );
    },
    click() {
      this.sendWidgetAction('clickButtonScrollUp');
    }
  });

  api.createWidget('scroll-down-button', {
    tagName: 'widget-button.btn.btn-default.discourse-scroll-down-button.no-text.btn-icon',
    html(attrs, state) {
      return h('span', [iconNode('arrow-down')] );
    },
    click() {
      this.sendWidgetAction('clickButtonScrollDown');
    }
  }); 
  
  api.createWidget('to-top-button', {
    tagName: 'btn-default.topic-footer-button.discourse-scroll-top-button.btn.btn-icon-text',
    html(attrs, state) {
      return h('span', ["To Top", iconNode('arrow-up')] );
    },
    click() {
      this.sendWidgetAction('clickButtonScrollUp');
    }
  });
  
  api.decorateWidget('timeline-footer-controls:before', function(helper) {
    return helper.attach('scroll-up-button');
  });
  api.decorateWidget('after-topic-footer-main-buttons:before', function(helper) {
    return helper.attach('scroll-down-button');
  });

  
  api.registerTopicFooterButton({
    // id of the button, required
    id: 99,

    // icon displayed on the button
    icon: "arrow-up",

    // local key path for title attribute
    title: null,
    
    action() {
      topicController.send('jumpTop');
    },

    // already translated title
    translatedTitle: null,

    // local key path for label
    label: "To Top",

    // already translated label
    translatedLabel: null,

    // is this button displayed in the mobile dropdown or as an inline button ?
    dropdown: false,

    // css class appended to the button
    classNames: [],

    // computed properties which should force a button state refresh
    // eg: ["topic.bookmarked", "topic.category_id"]
    dependentKeys: [],

    // should we display this button ?
    displayed: true,

    // is this button disabled ?
    disabled: false,

    // display order, higher comes first
    priority: 0
  });
  
  
</script>

